{% extends 'maneu/base_admin.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/maneu_order_v2/order_detail.css' %}">
{% endblock %}
{% block content %}
    <div class="container" style="margin-top: 3%; margin-bottom: 5%">
        <div class="col-12 row">
            <div class="col-2">
                <form method="get" action="{% url 'maneu_order_v2:index' %}">
                    <div class="input-group input-group-sm">
                        <input type="submit" class="btn btn-primary" value="返回">
                    </div>
                </form>
            </div>
        </div>
        <br>
        <table class="table table-bordered table-sm text-left" id="textArea">
            <tr class="banner">
                <td colspan="9">
                    <b>客户信息（Guess information）</b>
                </td>
            </tr>
            <tr>
                <td>
                    <span>创建时间</span>
                </td>
                <td colspan="2">
                    <span>{{ order.time }}</span>
                </td>
                <td>
                    <span>姓名</span>
                </td>
                <td colspan="2">
                    <span>{{ order.name }}</span>
                </td>
                <td>
                    <span>电话</span>
                </td>
                <td colspan="2">
                    <span>{{ order.phone }}</span>
                </td>
            </tr>
            <tr class="banner">
                <td colspan="9">
                    <b>视力解决方案（Vision Solutions）</b>
                </td>
            </tr>
            <tr>
                <td>
                    <span>参数</span>
                </td>
                <td>
                    <span>裸眼视力 VA</span>
                </td>
                <td>
                    <span>球镜 Sph</span>
                </td>
                <td>
                    <span>柱镜 Cyl</span>
                </td>
                <td>
                    <span>轴位 Axial</span>
                </td>
                <td>
                    <span>棱镜 Pr</span>
                </td>
                <td>
                    <span>基底取向 FR</span>
                </td>
                <td>
                    <span>下加光 ADD</span>
                </td>
                <td>
                    <span>矫正视力 BSCVA</span>
                </td>
            </tr>
            <tr>
                <td>
                    <span>右眼</span>
                </td>
                <td>
                    <span id="OD_VA"></span>
                </td>
                <td>
                    <span id="OD_SPH"></span>
                </td>
                <td>
                    <span id="OD_CYL"></span>
                </td>
                <td>
                    <span id="OD_AX"></span>
                </td>
                <td>
                    <span id="OD_PR"></span>
                </td>
                <td>
                    <span id="OD_FR"></span>
                </td>
                <td>
                    <span id="OD_ADD"></span>
                </td>
                <td>
                    <span id="OD_BCVA"></span>
                </td>
            </tr>
            <tr>
                <td>
                    <span>左眼</span>
                </td>
                <td>
                    <span id="OS_VA"></span>
                </td>
                <td>
                    <span id="OS_SPH"></span>
                </td>
                <td>
                    <span id="OS_CYL"></span>
                </td>
                <td>
                    <span id="OS_AX"></span>
                </td>
                <td>
                    <span id="OS_PR"></span>
                </td>
                <td>
                    <span id="OD_FR"></span>
                </td>
                <td>
                    <span id="OS_ADD"></span>
                </td>
                <td>
                    <span id="OS_BCVA"></span>
                </td>
            </tr>
            <tr>
                <td>
                    <span>使用需求</span>
                </td>
                <td colspan="8">
                    <span id="function"></span>
                </td>
            </tr>
            <tr>
                <td>
                    <span>瞳距</span>
                </td>
                <td colspan="8">
                    <span id="PD"></span>
                </td>
            </tr>
            <tr>
                <td>
                    <span>验光师建议</span>
                </td>
                <td colspan="8">
                    <span id="remark"></span>
                </td>
            </tr>
            <tr class="banner">
                <td colspan="9">
                    <b>产品订单信息（Product Orders）</b>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <span>类别</span>
                </td>
                <td colspan="2">
                    <span>品牌</span>
                </td>
                <td colspan="2">
                    <span>型号</span>
                </td>
                <td colspan="2">
                    <span>参数</span>
                </td>
                <td colspan="1">
                    <span>价格</span>
                </td>
            </tr>
            <tbody id="store_table"></tbody>
            <tr class="banner">
                <td colspan="9">
                    <b>注意事项（matters need attention）</b>
                </td>
            </tr>
            <tr>
                <td colspan="9">
                    <span>处方由眼科专家根据患者屈光不正性质、年龄、用眼需求等综合因素决定。</span>
                    <span>选择镜片、镜架及按眼科专家指导的配戴方法才能确保矫正效果和视觉健康。</span>
                    <span>数据为当时检查状态的结果，检查后如超过六个月配镜，建议复查。</span>
                </td>
            </tr>
        </table>
        <div class="col-12 row">
            <div class="col-2">
                <form method="post" action="{% url 'maneu_guest:detail' %}">
                    {% csrf_token %}
                    <input type="hidden" name="guess_id" value="{{ order.guess_id }}">
                    <div class="input-group input-group-sm">
                        <input type="submit" class="btn btn-primary" value="客户">
                    </div>
                </form>
            </div>
            <div class="col-2">
                <div class="input-group input-group-sm">
                    <button class="btn btn-primary" id="print_btn">打印</button>
                </div>
            </div>
            <div class="col-2">
                <form method="get" action="{% url 'maneu_order_v2:update' %}">
                    <input type="hidden" name="order_id" value="{{ order.id }}">
                    <div class="input-group input-group-sm">
                        <input type="submit" class="btn btn-warning" value="修改">
                    </div>
                </form>
            </div>
            <div class="col-2">
                <form method="post" action="{% url 'maneu_order_v2:delete' %}">
                    {% csrf_token %}
                    <input type="hidden" name="order_id" value="{{ order.id }}">
                    <div class="input-group input-group-sm">
                        <input type="submit" class="btn btn-danger" id="delete" value="删除">
                    </div>
                </form>
            </div>
        </div>
        <br>
        <table class="table">
            <tr>
                <td class="col-2">
                    <h5>售后记录</h5>
                </td>
                <td colspan="2"></td>
            </tr>
            <tr>
                <td class="col-2">
                    <span>时间</span>
                </td>
                <td class="col-9">
                    <span>内容</span>
                </td>
                <td class="col-1">
                    <div class="col-6 offset-6 input-group input-group-sm">
                        <input type="submit" class="btn btn-primary" value="添加">
                    </div>
                </td>
            </tr>
            <tr>
                <td class="col-11" colspan='3'>
                    <form id="serverInsert">
                        {% csrf_token %}
                        <div class="input-group input-group-sm">
                            <input type="text" name="content" class="form-control">
                            <input type="hidden" name="order_id" value="{{ order.id }}">
                            <input type="hidden" name="guess_id" value="{{ order.guess_id }}">
                            <input class="btn btn-primary" type="button" value="提交" id="serverInsertButton">
                        </div>
                    </form>
                </td>
            </tr>
            <tbody id="serverTable">
            {% if server %}
                {% for foo in server %}
                    <tr>
                        <td class="col-2">
                            <span>{{ foo.time }}</span>
                        </td>
                        <td class="col-9">
                            <span>{{ foo.content }}</span>
                        </td>
                        <td class="col-1">
                            <div class="col-6 offset-6 input-group input-group-sm">
                                <input type="button" class="btn btn-danger delete submit" value="删除" rel="{{ foo.id }}">
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td align="center" colspan="3">
                        <span>没有记录</span>
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
{% endblock %}
{% block javascript %}
    <script type="application/javascript">
        maneu_store = {{ store|safe }};
        maneu_vision = {{ vision|safe }};
        service_delete = "{% url 'maneu_service:delete' %}"
        serverInsertUrl = "{% url 'maneu_service:testsInsert' %}"
    </script>
    <script type="application/javascript" src="https://cdn.bootcdn.net/ajax/libs/jQuery.print/1.6.2/jQuery.print.js"></script>
    <script type="application/javascript" src="{% static 'javascript/maneu/delete.js' %}"></script>
    <script type="application/javascript" src="{% static 'javascript/maneu/print.js' %}"></script>
    <script type="application/javascript" src="{% static 'javascript/maneu_order/order_detail.js' %}"></script>
    <script type="application/javascript" src="{% static 'javascript/maneu/serialize_moudels.js' %}"></script>
{% endblock %}
