{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <title>徕可</title>
    <link rel="icon" href="{% static 'images/logo.svg' %}">
    <link rel="stylesheet" href="{% static 'css/maneu/login.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 新 Bootstrap5 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css">
    <!--  popper.min.js 用于弹窗、提示、下拉菜单 -->
    <script src="https://cdn.staticfile.org/popper.js/2.9.3/umd/popper.min.js"></script>
    <!-- 最新的 Bootstrap5 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
</head>

<body>
<div class="container-fluid">
    <div class="login-wrapper">
        <div class="header">徕可管理系统</div>
        <div class="form-wrapper">
            <label for="username">手机号:</label>
            <input type="text" class="input-item" id="call" placeholder="call" autocomplete="off">
        </div>
        <div class="form-wrapper" id="sendsms">
            <button class="btn" id="sendsms-btn">获取验证码</button>
        </div>
        <div class="form-wrapper" id="password">
            <label for="password">验证码:</label>
            <input type="text" class="input-item" id="code" placeholder="code" autocomplete="off">
            <button class="btn" id="login-btn">登录</button>
        </div>
        <div class="form-wrapper">
            <span class="msg" id="msg"></span>
            <a href="{% url 'index' %}"><button class="btn">返回</button></a>
        </div>
    </div>
</div>
</div>
</body>

<footer class="fixed-bottom text-center">
    <a href="https://beian.miit.gov.cn">粤ICP备2023070483号</a>
</footer>
</html>
<script>
    $(document).ready(function () {
        $("#password").hide();
        $("#sendsms-btn").click(function () {
            $.ajax({
                url: {% url 'sendsms' %},
                method: 'GET',
                data: {
                    call: $("#call").val(),
                },
                success: function (res) {
                    alert(res.status)
                    if (res.status === true){
                        $("#sendsms").hide();
                        $("#password").show();
                    }else {
                        $("#msg").text("发送短信失败"+ res.message)
                    }
                }
            })
        })
        $("#login-btn").click(function () {
            $.ajax({
                url: {% url 'loginVerify' %},
                method: 'GET',
                data: {
                    call: $("#call").val(),
                    code: $("#code").val()
                },
                success: function (res) {
                    if (res.status === true){
                        window.location.href = {% url 'maneu_order:index' %}
                    }else {
                        $("#msg").text(res.message)
                    }
                },
            })
        })
    })
</script>