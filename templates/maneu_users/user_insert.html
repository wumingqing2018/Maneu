{% extends 'maneu/base.html' %}
{% load static %}

{% block content %}
    <!--内容栏-->
    <div class="container">
        <div class="col-md-6 offset-md-3">
            <table class="table">
                <form id="user_insert">
                    {% csrf_token %}
                    <tr class="yellow">
                        <td style="width: 20%">
                            <p>账号: </p>
                        </td>
                        <td>
                            <input class="col-md-12 form-control" type="text" name="username">
                            <p id="username"></p>
                        </td>
                    </tr>
                    <tr class="yellow">
                        <td style="width: 20%">
                            <p>密码: </p>
                        </td>
                        <td>
                            <input class="col-md-12 form-control" type="text" name="password">
                            <p id="password"></p>
                        </td>
                    </tr>
                    <tr class="yellow">
                        <td style="width: 20%">
                            <p>电话: </p>
                        </td>
                        <td>
                            <input class="col-md-12 form-control" type="text" name="phone">
                            <p id="phone"></p>
                        </td>
                    </tr>
                    <tr class="yellow">
                        <td style="width: 20%">
                            <p>邮件: </p>
                        </td>
                        <td>
                            <input class="col-md-12 form-control" type="text" name="email">
                            <p id="email"></p>
                        </td>
                    </tr>
                    <tr class="yellow">
                        <td>
                            <a class="btn btn-warning" type="button" href="{% url 'maneu_users:user_list' %}">返回</a>
                        </td>
                        <td>
                            <input class="btn btn-primary col-md-12" id="btn-insert" type="button" value="添加">
                        </td>
                    </tr>
                </form>
            </table>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    <script>
        user_insert = "{% url 'maneu_users:api_user_insert' %}";
    </script>
    <script>
        $(document).ready(function () {
            $("#btn-insert").click(function () {
                $.ajax({
                    url: user_insert,
                    type: "POST",
                    data: $("#user_insert").serialize(),
                    success:function (res) {
                        console.log(res)
                        if (res.code === 0){
                            alert(res.msg)
                        } else if (res.code === 1) {
                            alert("请求错误")
                        } else if (res.code === 2){
                            for (i in res.msg){
                                error = $("#" + i)
                                error.html(res.msg[i])
                            }
                        } else if (res.code === 3) {
                            alert(res.msg)
                        }
                    }
                })
            })
        })
    </script>
{% endblock %}
